name: Naver News Crawler

on:
  schedule:
    - cron: '0 23 * * *' # ë§¤ì¼ í•œêµ­ ì‹œê°„ ì˜¤ì „ 8ì‹œ ì‹¤í–‰
  workflow_dispatch:      # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ ìƒì„±

jobs:
  build:
    runs-on: ubuntu-latest
    
    # [ì¶”ê°€] ê¹ƒí—ˆë¸Œ ì„œë²„ì— íŒŒì¼ ì“°ê¸° ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.
    permissions:
      contents: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run Crawler
      # [ì¶”ê°€] GitHub Secretsì— ì €ì¥í•œ API í‚¤ë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.
      env:
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      run: python main.py

    - name: Commit and Push
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        
        # [ìˆ˜ì •] CSV íŒŒì¼ê³¼ ìƒì„±ëœ ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸ë¥¼ ëª¨ë‘ ì €ì¥ì†Œì— ì¶”ê°€í•©ë‹ˆë‹¤.
        git add naver_today_news.csv AI_Daily_Report.md
        
        git commit -m "ğŸ¤– ìë™ AI ë‰´ìŠ¤ ë° ë™í–¥ ë¦¬í¬íŠ¸ ì—…ë°ì´íŠ¸" || echo "ë³€ê²½ì‚¬í•­ ì—†ìŒ"
        git push
