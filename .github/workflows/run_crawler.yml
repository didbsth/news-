name: Naver News Crawler

on:
  schedule:
    # í•œêµ­ ì‹œê°„(KST) ì˜¤ì „ 8ì‹œ 50ë¶„ ì‹¤í–‰ (UTC 23:50)
    - cron: '50 23 * * *'
  workflow_dispatch:      # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ ìƒì„±

jobs:
  build:
    runs-on: ubuntu-latest
    
    # [ìœ ì§€] ê¹ƒí—ˆë¸Œ ì„œë²„ì— íŒŒì¼ ì“°ê¸° ê¶Œí•œ ë¶€ì—¬
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # ê¸°ì¡´ requirements.txt ì„¤ì¹˜
          pip install -r requirements.txt
          # [ì¶”ê°€] ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•´ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì¶”ê°€ ì„¤ì¹˜í•©ë‹ˆë‹¤.
          pip install markdown google-genai scikit-learn pandas selenium webdriver-manager

      - name: Run Crawler
        # [ìœ ì§€] GitHub Secretsì˜ API í‚¤ í™˜ê²½ ë³€ìˆ˜ ì—°ê²°
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python main.py

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # [ì¶”ê°€] index.htmlì„ í¬í•¨í•˜ì—¬ ìƒì„±ëœ ëª¨ë“  ê²°ê³¼ íŒŒì¼ì„ ì¶”ì í•©ë‹ˆë‹¤.
          git add naver_today_news.csv AI_Daily_Report.md index.html
          
          git commit -m "ğŸ¤– ìë™ AI ë‰´ìŠ¤ ë° ë™í–¥ ë¦¬í¬íŠ¸ ì—…ë°ì´íŠ¸ ($(date +'%Y-%m-%d %H:%M'))" || echo "ë³€ê²½ì‚¬í•­ ì—†ìŒ"
          git push
