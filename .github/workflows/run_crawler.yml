name: Naver AI News Daily Web-Report

on:
  schedule:
    # í•œêµ­ ì‹œê°„(KST) ì˜¤ì „ 8ì‹œ 50ë¶„ = UTC ì „ë‚  ì˜¤í›„ 11ì‹œ 50ë¶„
    - cron: '50 23 * * *'
  workflow_dispatch:      # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ ìƒì„±

jobs:
  build:
    runs-on: ubuntu-latest
    
    # ê¹ƒí—ˆë¸Œ ì„œë²„ì— íŒŒì¼ ì“°ê¸° ê¶Œí•œ ë¶€ì—¬
    permissions:
      contents: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ ì§ì ‘ ì„¤ì¹˜ (requirements.txtê°€ ì—†ëŠ” ê²½ìš° ëŒ€ë¹„)
        pip install pandas selenium webdriver-manager scikit-learn google-genai

    - name: Run Crawler
      env:
        # GitHub Secretsì— ì €ì¥í•œ API í‚¤ ì‚¬ìš©
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      run: python main.py

    - name: Commit and Push
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        
        # [ìˆ˜ì •] ì›¹í˜ì´ì§€(index.html)ì™€ ë°ì´í„°(CSV)ë¥¼ ì €ì¥ì†Œì— ì¶”ê°€
        git add naver_today_news.csv index.html
        
        git commit -m "ğŸ¤– ìë™ AI ë‰´ìŠ¤ ì›¹í˜ì´ì§€ ì—…ë°ì´íŠ¸ ($(date +'%Y-%m-%d %H:%M'))" || echo "ë³€ê²½ì‚¬í•­ ì—†ìŒ"
        git push
